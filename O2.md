## 🏗 OpenObserve 実装ロードマップ

### 第1段階：永続化基盤の整備 (Storage Layer)

O2は「S3-First」なアーキテクチャであるため、まずはデータの定着先を定義します。

* **抽象化された要件**:
* O2本体はステートレス（状態を持たない）として構成。
* データの保存先として、S3互換のオブジェクトストレージ（MinIOなど）を抽象化されたエンドポイントとして定義。


* **成果物**: ストレージ接続情報を含む `Secret` および物理ボリュームの `PVC`。

### 第2段階：観測エンジンとしてのデプロイ (Compute Layer)

O2本体をクラスター内に配置します。

* **抽象化された要件**:
* Rustベースの単一バイナリとしてデプロイ。
* **リソース制限の抽象化**: メモリ消費のベースライン（約1GiB推奨）を考慮しつつ、環境変数でキャッシュサイズを動的に制御できるように設計。


* **成果物**: ログ・メトリクス・トレースを統合受信する `Deployment` と `Service`。

### 第3段階：データパイプラインの結合 (Pipeline Layer)

既存の VictoriaMetrics (VM) と O2 を「Remote Write」で接続します。

* **抽象化された要件**:
* **収集側 (VM)**: スクレイプしたメトリクスを外部（O2）へ転送する転送プロトコルを定義。
* **受信側 (O2)**: 認証トークンを介してデータを受け入れるエンドポイントを構築。


* **成果物**: VMからO2へデータを流し込むための `ConfigMap` 更新。

### 第4段階：統合可視化とライフサイクル管理 (Visualization & Ops)

貯まったデータを「知恵」に変えるフェーズです。

* **抽象化された要件**:
* **SQLベースの分析**: 特定のツールに依存しない標準SQLを用いたダッシュボードテンプレートの作成。
* **データの賞味期限**: オブジェクトストレージ側のポリシー（ライフサイクル管理）により、古いデータの自動削除を定義。



---

## 📂 推奨されるディレクトリ構成（Kustomize準拠）

実装の詳細を `base` に閉じ込め、環境ごとの差異（シークレットの有無など）を `overlays` で管理する、メンテナンス性の高い構成です。

```text
smart-home/
├── k8s/
│   ├── base/                # 抽象化された基本定義
│   │   ├── namespace.yaml   # smart-home空間の定義
│   │   ├── exporter/        # 自作Exporter（イメージ名はプレースホルダ）
│   │   ├── victoria-metrics/# 収集エンジン
│   │   └── openobserve/     # 可視化エンジン（設定は環境変数経由）
│   │
│   └── overlays/            # 具体的な実装・環境差分
│       ├── production/      # 本番環境（Sealed Secrets等を適用）
│       └── development/     # モックデータ・手元テスト用
```