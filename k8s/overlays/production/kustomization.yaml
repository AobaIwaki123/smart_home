apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: switchbot-exporter-production

# smart-homeネームスペースに配置
namespace: smart-home

# ベース設定の参照
resources:
- ../../base/namespace
- ../../base/exporter
- ../../base/victoriametrics
- ../../base/grafana
  # switchbot-secret.yaml は機密のため Git 管理外。
  # `make k8s-secret-generate && kubectl apply -f k8s/secret/switchbot-secret.yaml` で別途適用してください。
  # - ../../secret/switchbot-secret.yaml

# Production環境用の名前プリフィックス
namePrefix: prod-

# 本番環境用の設定を上書き
patches:
- path: deployment-patch.yaml
- path: victoriametrics-config-patch.yaml
  target:
    kind: ConfigMap
    name: victoria-metrics-scrape-config
- path: grafana-datasource-patch.yaml
  target:
    kind: ConfigMap
    name: grafana-datasources
- path: grafana-tailscale-patch.yaml
  target:
    kind: Service
    name: grafana

# 本番環境用のイメージタグ
images:
- name: ghcr.io/aobaiwaki123/switchbot-exporter
  newTag: 0.0.1
